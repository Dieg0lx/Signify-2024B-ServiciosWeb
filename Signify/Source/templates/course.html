<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ course.title }} - Signify</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/estilos.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/course.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <nav class="sidebar">
            <h1 class="logo">Signify</h1>
            <ul class="nav-links">
                <li><a href="{{ url_for('courses_page') }}">Cursos</a></li>
                <li><a href="{{ url_for('results') }}">Resultados</a></li>
                <li><a href="{{ url_for('profile') }}">Perfil</a></li>
            </ul>
        </nav>
        
        <main class="content">
            <div class="course-wrapper">
                <div class="course-header">
                    <h2>{{ course.title }}</h2>
                    <div class="progress-container">
                        <div class="progress-bar" id="progress-bar"></div>
                    </div>
                </div>
                <form method="POST" action="{{ url_for('submit_course', course_id=course.id) }}" class="course-form" id="course-form">
                    {% for question in course.questions %}
                    <div class="question" id="question-{{ question.id }}">
                        <h3>{{ question.question }}</h3>
                        <div class="options-container">
                            {% for option in question.options %}
                            <label class="option">
                                <input type="radio" name="{{ question.id }}" value="{{ option }}" required>
                                <span class="option-text">{{ option }}</span>
                            </label>
                            {% endfor %}
                        </div>
                    </div>
                    {% endfor %}
                    <div class="navigation-buttons">
                        <button type="button" id="prev-btn" class="nav-btn" disabled>Anterior</button>
                        <button type="button" id="next-btn" class="nav-btn">Siguiente</button>
                        <button type="submit" id="submit-btn" class="submit-btn" style="display: none;">Enviar respuestas</button>
                    </div>
                </form>
            </div>
        </main>
    </div>
    <script>
        const form = document.getElementById('course-form');
        const questions = document.querySelectorAll('.question');
        const progressBar = document.getElementById('progress-bar');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        const submitBtn = document.getElementById('submit-btn');
        let currentQuestion = 0;

        function showQuestion(index) {
            questions.forEach((q, i) => {
                if (i === index) {
                    q.style.display = 'block';
                } else {
                    q.style.display = 'none';
                }
            });
            updateProgressBar();
            updateNavigationButtons();
        }

        function updateProgressBar() {
            const progress = ((currentQuestion + 1) / questions.length) * 100;
            progressBar.style.width = `${progress}%`;
        }

        function updateNavigationButtons() {
            prevBtn.disabled = currentQuestion === 0;
            if (currentQuestion === questions.length - 1) {
                nextBtn.style.display = 'none';
                submitBtn.style.display = 'block';
            } else {
                nextBtn.style.display = 'block';
                submitBtn.style.display = 'none';
            }
        }

        prevBtn.addEventListener('click', () => {
            if (currentQuestion > 0) {
                currentQuestion--;
                showQuestion(currentQuestion);
            }
        });

        nextBtn.addEventListener('click', () => {
            const radios = questions[currentQuestion].querySelectorAll('input[type="radio"]');
            const answered = Array.from(radios).some(r => r.checked);
            if (answered && currentQuestion < questions.length - 1) {
                currentQuestion++;
                showQuestion(currentQuestion);
            } else if (!answered) {
                alert('Por favor, selecciona una respuesta antes de continuar.');
            }
        });

        form.addEventListener('submit', (e) => {
            const allQuestionsAnswered = Array.from(questions).every(q => {
                const radios = q.querySelectorAll('input[type="radio"]');
                return Array.from(radios).some(r => r.checked);
            });

            if (!allQuestionsAnswered) {
                e.preventDefault();
                alert('Por favor, responde todas las preguntas antes de enviar.');
            }
        });

        showQuestion(currentQuestion);
    </script>
</body>
</html>